{"code":"(window.webpackJsonp=window.webpackJsonp||[]).push([[15],{220:function(a,t,s){\"use strict\";s.r(t);var n=s(0),e=Object(n.a)({},function(){this.$createElement;this._self._c;return this._m(0)},[function(){var a=this,t=a.$createElement,s=a._self._c||t;return s(\"div\",{staticClass:\"content\"},[s(\"h3\",{attrs:{id:\"用户知识\"}},[s(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#用户知识\",\"aria-hidden\":\"true\"}},[a._v(\"#\")]),a._v(\" 用户知识\")]),a._v(\" \"),s(\"p\",[a._v(\"a.MongoDB是没有默认管理员账号的，所以要先添加管理员账号，在开启权限认证。\")]),a._v(\" \"),s(\"p\",[a._v(\"b.切换到admin数据库，添加的账号才是管理员的账号。\")]),a._v(\" \"),s(\"p\",[a._v(\"c.用户只能在用户所在的数据库登录，包括管理员账号。\")]),a._v(\" \"),s(\"p\",[a._v(\"d.管理员可以管理所有的数据库，但是不能直接管理其它数据库，要先在admin数据库中认证才可以，也是为了 安全性考虑。\")]),a._v(\" \"),s(\"h3\",{attrs:{id:\"添加管理员\"}},[s(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#添加管理员\",\"aria-hidden\":\"true\"}},[a._v(\"#\")]),a._v(\" 添加管理员\")]),a._v(\" \"),s(\"div\",{staticClass:\"language- extra-class\"},[s(\"pre\",{pre:!0,attrs:{class:\"language-text\"}},[s(\"code\",[a._v(\"show dbs\\n\")])])]),s(\"p\",[a._v(\"查看数据库列表：\\n发现有admin和local两个数据库\")]),a._v(\" \"),s(\"p\",[a._v(\"进入admin 数据库：\")]),a._v(\" \"),s(\"div\",{staticClass:\"language- extra-class\"},[s(\"pre\",{pre:!0,attrs:{class:\"language-text\"}},[s(\"code\",[a._v(\"use admin\\n\")])])]),s(\"p\",[a._v(\"然后查看admin下面有什么集合：\")]),a._v(\" \"),s(\"div\",{staticClass:\"language- extra-class\"},[s(\"pre\",{pre:!0,attrs:{class:\"language-text\"}},[s(\"code\",[a._v(\"show collections\\n\")])])]),s(\"p\",[a._v(\"我们可以看到有两个表：\")]),a._v(\" \"),s(\"p\",[a._v(\"system.users（这张表是用来存放超级管理员的）\")]),a._v(\" \"),s(\"p\",[a._v(\"system.version\")]),a._v(\" \"),s(\"p\",[a._v(\"接下来：创建管理员账户：\")]),a._v(\" \"),s(\"div\",{staticClass:\"language-js extra-class\"},[s(\"pre\",{pre:!0,attrs:{class:\"language-js\"}},[s(\"code\",[s(\"span\",{attrs:{class:\"token operator\"}},[a._v(\">\")]),a._v(\" db\"),s(\"span\",{attrs:{class:\"token punctuation\"}},[a._v(\".\")]),s(\"span\",{attrs:{class:\"token function\"}},[a._v(\"createUser\")]),s(\"span\",{attrs:{class:\"token punctuation\"}},[a._v(\"(\")]),a._v(\"\\n    \"),s(\"span\",{attrs:{class:\"token punctuation\"}},[a._v(\"{\")]),a._v(\"user\"),s(\"span\",{attrs:{class:\"token punctuation\"}},[a._v(\":\")]),s(\"span\",{attrs:{class:\"token string\"}},[a._v(\"'admin'\")]),s(\"span\",{attrs:{class:\"token punctuation\"}},[a._v(\",\")]),a._v(\"\\n    pwd\"),s(\"span\",{attrs:{class:\"token punctuation\"}},[a._v(\":\")]),s(\"span\",{attrs:{class:\"token string\"}},[a._v(\"'xiaojun'\")]),s(\"span\",{attrs:{class:\"token punctuation\"}},[a._v(\",\")]),a._v(\"\\n    roles\"),s(\"span\",{attrs:{class:\"token punctuation\"}},[a._v(\":\")]),a._v(\"\\n    \"),s(\"span\",{attrs:{class:\"token punctuation\"}},[a._v(\"[\")]),a._v(\"\\n        \"),s(\"span\",{attrs:{class:\"token punctuation\"}},[a._v(\"{\")]),a._v(\"role\"),s(\"span\",{attrs:{class:\"token punctuation\"}},[a._v(\":\")]),s(\"span\",{attrs:{class:\"token string\"}},[a._v(\"'userAdminAnyDatabase'\")]),s(\"span\",{attrs:{class:\"token punctuation\"}},[a._v(\",\")]),a._v(\"db\"),s(\"span\",{attrs:{class:\"token punctuation\"}},[a._v(\":\")]),s(\"span\",{attrs:{class:\"token string\"}},[a._v(\"'admin'\")]),s(\"span\",{attrs:{class:\"token punctuation\"}},[a._v(\"}\")]),a._v(\"\\n    \"),s(\"span\",{attrs:{class:\"token punctuation\"}},[a._v(\"]\")]),a._v(\"\\n\"),s(\"span\",{attrs:{class:\"token punctuation\"}},[a._v(\"}\")]),s(\"span\",{attrs:{class:\"token punctuation\"}},[a._v(\")\")]),a._v(\"\\n\")])])]),s(\"p\",[a._v(\"当添加完用户信息之后，我们的想法就是马上重新连接验证是否权限已经控制，这里就打击你了，当然还没有控制，这里我们还需要开启用户权限验证，因为MongoDB默认是不开启权限验证的，下面我们简单说一下如何开启权限验证：\")]),a._v(\" \"),s(\"div\",{staticClass:\"language-js extra-class\"},[s(\"pre\",{pre:!0,attrs:{class:\"language-js\"}},[s(\"code\",[a._v(\"在mongo\"),s(\"span\",{attrs:{class:\"token punctuation\"}},[a._v(\".\")]),a._v(\"conf添加auth\"),s(\"span\",{attrs:{class:\"token operator\"}},[a._v(\"=\")]),s(\"span\",{attrs:{class:\"token boolean\"}},[a._v(\"true\")]),a._v(\"\\n\")])])]),s(\"p\",[a._v(\"重启服务：\")]),a._v(\" \"),s(\"div\",{staticClass:\"language-js extra-class\"},[s(\"pre\",{pre:!0,attrs:{class:\"language-js\"}},[s(\"code\",[a._v(\"退出mongo shell ：\\nexit\\n\\n停止mongodb服务：\\nnet stop mongodb\\n\\n启动mongodb服务：\\nnet start mongodb\\n\\n\\n\")])])]),s(\"p\",[a._v(\"然后mongo进入shell：\\n进入admin\")]),a._v(\" \"),s(\"div\",{staticClass:\"language- extra-class\"},[s(\"pre\",{pre:!0,attrs:{class:\"language-text\"}},[s(\"code\",[a._v(\"use admin\\n\")])])]),s(\"p\",[a._v(\"然后查看users表，发现没有权限访问：\")]),a._v(\" \"),s(\"p\",[s(\"img\",{attrs:{src:\"http://note.youdao.com/yws/api/personal/file/072CA2E68FAA4100AD9B36EE0D659387?method=download&shareKey=01fe18f0f4b959f602f0ce3d6b26102e\",alt:\"image\"}})]),a._v(\" \"),s(\"p\",[a._v(\"当我们用admin登录认证后，就可以访问了：\")]),a._v(\" \"),s(\"div\",{staticClass:\"language- extra-class\"},[s(\"pre\",{pre:!0,attrs:{class:\"language-text\"}},[s(\"code\",[a._v(\"db.auth('admin','xiaojun')\\n\")])])]),s(\"p\",[s(\"img\",{attrs:{src:\"http://note.youdao.com/yws/api/personal/file/1155C698BB83475080270F34E4299D94?method=download&shareKey=2c84c0dbfbea2c12f12a5e2656f54f2d\",alt:\"image\"}})]),a._v(\" \"),s(\"p\",[a._v(\"在这里我们创建一个集合:\")]),a._v(\" \"),s(\"div\",{staticClass:\"language- extra-class\"},[s(\"pre\",{pre:!0,attrs:{class:\"language-text\"}},[s(\"code\",[a._v(\"use xiaojun\\n\\n\")])])]),s(\"p\",[a._v(\"然后插入数据：\")]),a._v(\" \"),s(\"div\",{staticClass:\"language-js extra-class\"},[s(\"pre\",{pre:!0,attrs:{class:\"language-js\"}},[s(\"code\",[a._v(\"db\"),s(\"span\",{attrs:{class:\"token punctuation\"}},[a._v(\".\")]),a._v(\"xiaojun\"),s(\"span\",{attrs:{class:\"token punctuation\"}},[a._v(\".\")]),s(\"span\",{attrs:{class:\"token function\"}},[a._v(\"insert\")]),s(\"span\",{attrs:{class:\"token punctuation\"}},[a._v(\"(\")]),s(\"span\",{attrs:{class:\"token punctuation\"}},[a._v(\"{\")]),a._v(\"name\"),s(\"span\",{attrs:{class:\"token punctuation\"}},[a._v(\":\")]),s(\"span\",{attrs:{class:\"token string\"}},[a._v(\"'xiaojun'\")]),s(\"span\",{attrs:{class:\"token punctuation\"}},[a._v(\"}\")]),s(\"span\",{attrs:{class:\"token punctuation\"}},[a._v(\")\")]),s(\"span\",{attrs:{class:\"token punctuation\"}},[a._v(\";\")]),a._v(\"\\n\")])])]),s(\"p\",[a._v(\"发现错误：\")]),a._v(\" \"),s(\"p\",[s(\"img\",{attrs:{src:\"http://note.youdao.com/yws/api/personal/file/0355CC3333B24B0B97F89853665BF3CF?method=download&shareKey=a7c12ddff5eb3f1b997f3ba02dc854ee\",alt:\"image\"}})]),a._v(\" \"),s(\"p\",[s(\"strong\",[a._v(\"这是因为给admin授权的userAdminAnyDatabase权限只是针对用户管理的，对其它的表示没有操作权限的\")])]),a._v(\" \"),s(\"h4\",{attrs:{id:\"b-关于mongodb的内置角色，我们大概可以分为以下几种来简单说一下\"}},[s(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#b-关于mongodb的内置角色，我们大概可以分为以下几种来简单说一下\",\"aria-hidden\":\"true\"}},[a._v(\"#\")]),a._v(\" b 关于MongoDB的内置角色，我们大概可以分为以下几种来简单说一下\")]),a._v(\" \"),s(\"p\",[a._v(\"b.1 DatabaseUserRoles(数据库用户角色)：read、readWrite\")]),a._v(\" \"),s(\"p\",[a._v(\"b.2 Database Administration Roles(数据库管理角色)：dbAdmin、dbOwner、userAdmin\")]),a._v(\" \"),s(\"p\",[a._v(\"b.3 Culster AdministrationRoles(管理员组，针对整个系统进行管理)：clusterAdmin、clusterManager、clusterMonitor、hostManager\")]),a._v(\" \"),s(\"p\",[a._v(\"b.4 Backup and Restoration Roles(备份还原角色组)：backup、restore\")]),a._v(\" \"),s(\"p\",[a._v(\"b.5 All-Database Roles(所有数据库角色)：readAnyDatabase、readWriteAnyDatabase、userAdminAnyDatabase、dbAdminAnyDatabase\")]),a._v(\" \"),s(\"p\",[a._v(\"b.6 Superuser Roles(超级管理员)：root、(dbOwner、userAdmin、userAdminAnyDatabase这几个角色角色提供了任何数据任何用户的任何权限的能力，拥有这个角色的用户可以在任何数据库上定义它们自己的权限)\")]),a._v(\" \"),s(\"p\",[a._v(\"b.7  Internal Role(内部角色，一般情况下不建议设置)：__system\")]),a._v(\" \"),s(\"h3\",{attrs:{id:\"下面我们创建一个超级管理员-超级管理员可以对任意数据库做任意操作，有最高权限-：\"}},[s(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#下面我们创建一个超级管理员-超级管理员可以对任意数据库做任意操作，有最高权限-：\",\"aria-hidden\":\"true\"}},[a._v(\"#\")]),a._v(\" 下面我们创建一个超级管理员(超级管理员可以对任意数据库做任意操作，有最高权限)：\")]),a._v(\" \"),s(\"div\",{staticClass:\"language-js extra-class\"},[s(\"pre\",{pre:!0,attrs:{class:\"language-js\"}},[s(\"code\",[a._v(\"use admin\\ndb\"),s(\"span\",{attrs:{class:\"token punctuation\"}},[a._v(\".\")]),s(\"span\",{attrs:{class:\"token function\"}},[a._v(\"createUser\")]),s(\"span\",{attrs:{class:\"token punctuation\"}},[a._v(\"(\")]),s(\"span\",{attrs:{class:\"token punctuation\"}},[a._v(\"{\")]),a._v(\"user\"),s(\"span\",{attrs:{class:\"token punctuation\"}},[a._v(\":\")]),s(\"span\",{attrs:{class:\"token string\"}},[a._v(\"'root'\")]),s(\"span\",{attrs:{class:\"token punctuation\"}},[a._v(\",\")]),a._v(\"pwd\"),s(\"span\",{attrs:{class:\"token punctuation\"}},[a._v(\":\")]),s(\"span\",{attrs:{class:\"token string\"}},[a._v(\"'root'\")]),s(\"span\",{attrs:{class:\"token punctuation\"}},[a._v(\",\")]),a._v(\"roles\"),s(\"span\",{attrs:{class:\"token punctuation\"}},[a._v(\":\")]),s(\"span\",{attrs:{class:\"token punctuation\"}},[a._v(\"[\")]),s(\"span\",{attrs:{class:\"token punctuation\"}},[a._v(\"{\")]),a._v(\"role\"),s(\"span\",{attrs:{class:\"token punctuation\"}},[a._v(\":\")]),s(\"span\",{attrs:{class:\"token string\"}},[a._v(\"'root'\")]),s(\"span\",{attrs:{class:\"token punctuation\"}},[a._v(\",\")]),a._v(\"db\"),s(\"span\",{attrs:{class:\"token punctuation\"}},[a._v(\":\")]),s(\"span\",{attrs:{class:\"token string\"}},[a._v(\"'admin'\")]),s(\"span\",{attrs:{class:\"token punctuation\"}},[a._v(\"}\")]),s(\"span\",{attrs:{class:\"token punctuation\"}},[a._v(\"]\")]),s(\"span\",{attrs:{class:\"token punctuation\"}},[a._v(\"}\")]),s(\"span\",{attrs:{class:\"token punctuation\"}},[a._v(\")\")]),a._v(\"\\n\\n授权给超级管理员：\\ndb\"),s(\"span\",{attrs:{class:\"token punctuation\"}},[a._v(\".\")]),s(\"span\",{attrs:{class:\"token function\"}},[a._v(\"auth\")]),s(\"span\",{attrs:{class:\"token punctuation\"}},[a._v(\"(\")]),s(\"span\",{attrs:{class:\"token string\"}},[a._v(\"'root'\")]),s(\"span\",{attrs:{class:\"token punctuation\"}},[a._v(\",\")]),s(\"span\",{attrs:{class:\"token string\"}},[a._v(\"'root'\")]),s(\"span\",{attrs:{class:\"token punctuation\"}},[a._v(\")\")]),s(\"span\",{attrs:{class:\"token punctuation\"}},[a._v(\";\")]),a._v(\"\\n\")])])]),s(\"p\",[a._v(\"然后我们创建一个数据库xiaojun和集合child，并插入数据：\")]),a._v(\" \"),s(\"div\",{staticClass:\"language-js extra-class\"},[s(\"pre\",{pre:!0,attrs:{class:\"language-js\"}},[s(\"code\",[a._v(\"use xiaojun\\n\\ndb\"),s(\"span\",{attrs:{class:\"token punctuation\"}},[a._v(\".\")]),a._v(\"child\"),s(\"span\",{attrs:{class:\"token punctuation\"}},[a._v(\".\")]),s(\"span\",{attrs:{class:\"token function\"}},[a._v(\"insert\")]),s(\"span\",{attrs:{class:\"token punctuation\"}},[a._v(\"(\")]),s(\"span\",{attrs:{class:\"token punctuation\"}},[a._v(\"{\")]),a._v(\"name\"),s(\"span\",{attrs:{class:\"token punctuation\"}},[a._v(\":\")]),s(\"span\",{attrs:{class:\"token string\"}},[a._v(\"'xiaojun'\")]),s(\"span\",{attrs:{class:\"token punctuation\"}},[a._v(\"}\")]),s(\"span\",{attrs:{class:\"token punctuation\"}},[a._v(\")\")]),a._v(\"\\n\\n\")])])]),s(\"p\",[a._v(\"我们发现上面的操作都可以进行，这就是超级管理员的作用，拥有一切权限。\")]),a._v(\" \"),s(\"h3\",{attrs:{id:\"注意注意：在哪个数据库创建的角色就需要在哪个数据库下授权，才能成功：\"}},[s(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#注意注意：在哪个数据库创建的角色就需要在哪个数据库下授权，才能成功：\",\"aria-hidden\":\"true\"}},[a._v(\"#\")]),a._v(\" 注意注意：在哪个数据库创建的角色就需要在哪个数据库下授权，才能成功：\")]),a._v(\" \"),s(\"p\",[a._v(\"比如：我们有两个数据库：xiao和da\")]),a._v(\" \"),s(\"p\",[a._v(\"我们在da下，创建指向数据库xiao的角色用户（user:'xiao'）：\")]),a._v(\" \"),s(\"div\",{staticClass:\"language-js extra-class\"},[s(\"pre\",{pre:!0,attrs:{class:\"language-js\"}},[s(\"code\",[a._v(\"use da\\n\\ndb\"),s(\"span\",{attrs:{class:\"token punctuation\"}},[a._v(\".\")]),s(\"span\",{attrs:{class:\"token function\"}},[a._v(\"createUser\")]),s(\"span\",{attrs:{class:\"token punctuation\"}},[a._v(\"(\")]),s(\"span\",{attrs:{class:\"token punctuation\"}},[a._v(\"{\")]),a._v(\"user\"),s(\"span\",{attrs:{class:\"token punctuation\"}},[a._v(\":\")]),s(\"span\",{attrs:{class:\"token string\"}},[a._v(\"'xiao'\")]),s(\"span\",{attrs:{class:\"token punctuation\"}},[a._v(\",\")]),a._v(\"pwd\"),s(\"span\",{attrs:{class:\"token punctuation\"}},[a._v(\":\")]),s(\"span\",{attrs:{class:\"token string\"}},[a._v(\"'xiao'\")]),s(\"span\",{attrs:{class:\"token punctuation\"}},[a._v(\",\")]),a._v(\"roles\"),s(\"span\",{attrs:{class:\"token punctuation\"}},[a._v(\":\")]),s(\"span\",{attrs:{class:\"token punctuation\"}},[a._v(\"[\")]),s(\"span\",{attrs:{class:\"token punctuation\"}},[a._v(\"{\")]),a._v(\"role\"),s(\"span\",{attrs:{class:\"token punctuation\"}},[a._v(\":\")]),s(\"span\",{attrs:{class:\"token string\"}},[a._v(\"'read'\")]),s(\"span\",{attrs:{class:\"token punctuation\"}},[a._v(\",\")]),a._v(\"db\"),s(\"span\",{attrs:{class:\"token punctuation\"}},[a._v(\":\")]),s(\"span\",{attrs:{class:\"token string\"}},[a._v(\"'xiao'\")]),s(\"span\",{attrs:{class:\"token punctuation\"}},[a._v(\"}\")]),s(\"span\",{attrs:{class:\"token punctuation\"}},[a._v(\"]\")]),s(\"span\",{attrs:{class:\"token punctuation\"}},[a._v(\"}\")]),s(\"span\",{attrs:{class:\"token punctuation\"}},[a._v(\")\")]),a._v(\"\\n\\n\")])])]),s(\"p\",[a._v(\"好了，我们创建成功了，当我们切换到xiao，然后授权给用户角色（user:'xiao'）：\")]),a._v(\" \"),s(\"div\",{staticClass:\"language-js extra-class\"},[s(\"pre\",{pre:!0,attrs:{class:\"language-js\"}},[s(\"code\",[a._v(\"use xiao\\n\\ndb\"),s(\"span\",{attrs:{class:\"token punctuation\"}},[a._v(\".\")]),s(\"span\",{attrs:{class:\"token function\"}},[a._v(\"auth\")]),s(\"span\",{attrs:{class:\"token punctuation\"}},[a._v(\"(\")]),s(\"span\",{attrs:{class:\"token string\"}},[a._v(\"'xiao'\")]),s(\"span\",{attrs:{class:\"token punctuation\"}},[a._v(\",\")]),s(\"span\",{attrs:{class:\"token string\"}},[a._v(\"'xiao'\")]),s(\"span\",{attrs:{class:\"token punctuation\"}},[a._v(\")\")]),a._v(\"\\n\")])])]),s(\"p\",[a._v(\"然后发现失败了，不能授权\")]),a._v(\" \"),s(\"p\",[s(\"img\",{attrs:{src:\"http://note.youdao.com/yws/api/personal/file/5C0F61E33ABC4CFAA1A99AE1B66B9740?method=download&shareKey=764525a634678047bf4d22bb26597333\",alt:\"image\"}})]),a._v(\" \"),s(\"p\",[s(\"strong\",[a._v(\"这是因为，user：xiao角色是在da数据库下创建的，所以必须在da数据库下才能授权成功\")])]),a._v(\" \"),s(\"p\",[a._v(\"我们切换到da用户，然后授权给user：xiao：\")]),a._v(\" \"),s(\"div\",{staticClass:\"language-js extra-class\"},[s(\"pre\",{pre:!0,attrs:{class:\"language-js\"}},[s(\"code\",[a._v(\"use da\\ndb\"),s(\"span\",{attrs:{class:\"token punctuation\"}},[a._v(\".\")]),s(\"span\",{attrs:{class:\"token function\"}},[a._v(\"auth\")]),s(\"span\",{attrs:{class:\"token punctuation\"}},[a._v(\"(\")]),s(\"span\",{attrs:{class:\"token string\"}},[a._v(\"'xiao'\")]),s(\"span\",{attrs:{class:\"token punctuation\"}},[a._v(\",\")]),s(\"span\",{attrs:{class:\"token string\"}},[a._v(\"'xiao'\")]),s(\"span\",{attrs:{class:\"token punctuation\"}},[a._v(\")\")]),a._v(\"\\n\")])])]),s(\"p\",[s(\"img\",{attrs:{src:\"http://note.youdao.com/yws/api/personal/file/58F3FD40956A4F339617F85462B67165?method=download&shareKey=86f81545302d78304cbef624cf8aafcc\",alt:\"image\"}})]),a._v(\" \"),s(\"p\",[a._v(\"其实我们查看用户是在那个数据库下创建的，也可以查看该用户是授权给哪个数据库（即是它的权限是操作哪个数据库的）：\")]),a._v(\" \"),s(\"div\",{staticClass:\"language-js extra-class\"},[s(\"pre\",{pre:!0,attrs:{class:\"language-js\"}},[s(\"code\",[a._v(\"use admin\\ndb\"),s(\"span\",{attrs:{class:\"token punctuation\"}},[a._v(\".\")]),a._v(\"system\"),s(\"span\",{attrs:{class:\"token punctuation\"}},[a._v(\".\")]),a._v(\"users\"),s(\"span\",{attrs:{class:\"token punctuation\"}},[a._v(\".\")]),s(\"span\",{attrs:{class:\"token function\"}},[a._v(\"find\")]),s(\"span\",{attrs:{class:\"token punctuation\"}},[a._v(\"(\")]),s(\"span\",{attrs:{class:\"token punctuation\"}},[a._v(\")\")]),a._v(\"\\n\")])])]),s(\"p\",[s(\"img\",{attrs:{src:\"http://note.youdao.com/yws/api/personal/file/C22E3B84D5A34BDF91DF6306FC04FAA5?method=download&shareKey=4204de5c6b8c550a4192491ea3993455\",alt:\"image\"}})])])}],!1,null,null,null);e.options.__file=\"mongodb添加管理员和用户.md\";t.default=e.exports}}]);","extractedComments":[]}